import{r as a,t as l,j as e,e as K,m as X,X as M,h as u}from"./index-B5frEt5u.js";import{S as O}from"./send-Da6oV0bO.js";import{C as Y,a as Z}from"./element-movement-B5hWxci9.js";import{H as ee,k as se,B as te,U as ae,a as re}from"./combobox-CCreJGnk.js";import"./open-closed-BNHp7105.js";const xe=()=>{const[T,w]=a.useState(!1),[h,k]=a.useState(""),[n,S]=a.useState(null),[c,C]=a.useState(""),[x,I]=a.useState(""),[_,$]=a.useState([]),[j,J]=a.useState([]),[ie,P]=a.useState(!1),[z,U]=a.useState(!1),[y,D]=a.useState(!1),[r,L]=a.useState(null),[R,A]=a.useState(!1),[g,b]=a.useState(!1),[m,N]=a.useState(["dashboard"]),[p,G]=a.useState(""),B=p===""?_:_.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())||s.email.toLowerCase().includes(p.toLowerCase()));a.useEffect(()=>{H(),E()},[]);const H=async()=>{P(!0);try{const t=await(await fetch(`${window.API_BASE_URL}/api/admin/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();if(t.success){const i=t.data.filter(o=>o.role&&o.role.toUpperCase()==="USER");$(i)}}catch(s){console.error("Error fetching users:",s)}finally{P(!1)}},E=async()=>{U(!0);try{const t=await(await fetch(`${window.API_BASE_URL}/api/admin/notifications`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();t.success&&J(t.data)}catch(s){console.error("Error fetching notifications:",s),l.error("Gagal memuat riwayat notifikasi")}finally{U(!1)}},V=()=>{w(!0),b(!1),k(""),S(null),C(""),I(""),N(["dashboard"])},f=()=>{w(!1),b(!1),N(["dashboard"])},q=()=>{if(!n||!c||!x||!h){l.warning("Semua field (User, Judul, Subjek, Pesan) harus diisi");return}b(!0)},Q=()=>{b(!1)},F=s=>{N(t=>t.includes(s)?t.length===1?(l.warning("Minimal satu metode pengiriman harus dipilih"),t):t.filter(i=>i!==s):[...t,s])},W=async()=>{if(!n||!c||!x||!h){l.warning("Data tidak lengkap");return}D(!0);try{const s=`${window.API_BASE_URL}/api/notifications/send`,o=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({user_id:n.id,title:c,subject:x,message:h,channels:m})})).json();o.success?(l.success(o.message||"Notifikasi berhasil dikirim!"),f(),E()):l.error(o.message||"Gagal memproses notifikasi")}catch(s){console.error("Error submitting notification:",s),l.error("Terjadi kesalahan saat memproses notifikasi")}finally{D(!1)}},d=s=>{L(s),A(!0)},v=()=>{A(!1),L(null)};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Notifikasi"}),e.jsx("p",{className:"text-gray-600",children:"Kelola notifikasi dan pesan untuk pelamar."})]}),e.jsxs("button",{onClick:V,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl shadow-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all",children:[e.jsx(O,{className:"-ml-1 mr-2 h-5 w-5","aria-hidden":"true"}),"Kirim Notifikasi"]})]}),e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-100 overflow-hidden",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(K,{className:"w-8 h-8 animate-spin text-blue-600"})}):j.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mb-6",children:e.jsx(X,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Belum ada riwayat notifikasi"}),e.jsxs("p",{className:"text-gray-500 text-center leading-relaxed",children:["Anda belum mengirimkan notifikasi apapun kepada pelamar. ",e.jsx("br",{}),"Klik tombol di atas untuk mulai mengirim pesan."]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Penerima"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Judul"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subjek"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pesan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Waktu"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap cursor-pointer",onClick:()=>d(s),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold mr-3",children:s.user_name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.user_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.user_email})]})]})}),e.jsx("td",{className:"px-6 py-4 cursor-pointer",onClick:()=>d(s),children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title})}),e.jsx("td",{className:"px-6 py-4 cursor-pointer",onClick:()=>d(s),children:e.jsx("div",{className:"text-sm text-gray-600",children:s.subject})}),e.jsx("td",{className:"px-6 py-4 cursor-pointer",onClick:()=>d(s),children:e.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:s.message})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 cursor-pointer",onClick:()=>d(s),children:new Date(s.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden divide-y divide-gray-100",children:j.map(s=>e.jsxs("div",{className:"p-4 active:bg-gray-50 transition-colors",onClick:()=>d(s),children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold mr-3",children:s.user_name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s.user_name}),e.jsx("div",{className:"text-[10px] text-gray-500",children:s.user_email})]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-bold text-gray-800",children:s.title}),e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:s.subject}),e.jsxs("div",{className:"text-xs text-gray-500 line-clamp-2 mt-1 italic",children:['"',s.message,'"']}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-2 flex justify-end italic font-medium",children:new Date(s.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},s.id))})]})}),T&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity",onClick:f}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:g?"Konfirmasi Pengiriman":"Kirim Notifikasi"}),e.jsx("p",{className:"text-sm text-gray-500",children:g?"Pilih metode pengiriman pesan":"Isi detail pesan untuk pelamar"})]}),e.jsxs("button",{type:"button",className:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-full transition-colors",onClick:f,children:[e.jsx("span",{className:"sr-only",children:"Tutup"}),e.jsx(M,{className:"w-5 h-5"})]})]}),e.jsx("div",{className:"p-6 space-y-5",children:g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Ringkasan Pesan"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Penerima:"})," ",n?.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Judul:"})," ",c]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Subjek:"})," ",x]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-3 block",children:"Pilih Metode Pengiriman"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-start p-4 rounded-xl border cursor-pointer transition-all ${m.includes("dashboard")?"border-blue-500 bg-blue-50/50 ring-1 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>F("dashboard"),children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"channel-dashboard",name:"channel-dashboard",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",checked:m.includes("dashboard"),readOnly:!0})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"channel-dashboard",className:"font-bold text-gray-900 cursor-pointer",children:"Dashboard Notification"}),e.jsx("p",{className:"text-gray-500",children:"Kirim notifikasi ke dashboard aplikasi user."})]})]}),e.jsxs("div",{className:`flex items-start p-4 rounded-xl border cursor-pointer transition-all ${m.includes("email")?"border-blue-500 bg-blue-50/50 ring-1 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>F("email"),children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"channel-email",name:"channel-email",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",checked:m.includes("email"),readOnly:!0})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"channel-email",className:"font-bold text-gray-900 cursor-pointer",children:"Email (Gmail)"}),e.jsxs("p",{className:"text-gray-500",children:["Kirim salinan pesan ke alamat email user (",n?.email,")."]})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1.5",children:"Penerima"}),e.jsx(ee,{value:n,onChange:S,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:"relative w-full cursor-default overflow-hidden rounded-xl border border-gray-300 bg-white text-left shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm",children:[e.jsx(se,{className:"w-full border-none py-3 pl-4 pr-10 text-sm leading-5 text-gray-900 focus:ring-0",displayValue:s=>s?.name,onChange:s=>G(s.target.value),placeholder:"Cari nama atau email..."}),e.jsx(te,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx(Y,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(ae,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-xl bg-white py-1 text-base shadow-xl ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:B.length===0&&p!==""?e.jsx("div",{className:"relative cursor-default select-none py-2 px-4 text-gray-700",children:"Tidak ditemukan."}):B.map(s=>e.jsx(re,{className:({active:t})=>u(t?"bg-blue-600 text-white":"text-gray-900","relative cursor-default select-none py-3 pl-4 pr-9"),value:s,children:({selected:t,active:i})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:u("w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold mr-3",i?"bg-white/20 text-white":"bg-gray-100 text-gray-600"),children:s.name.charAt(0)}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:u(t?"font-semibold":"font-medium","block truncate"),children:s.name}),e.jsx("span",{className:u("text-xs",i?"text-blue-100":"text-gray-500"),children:s.email})]})]}),t?e.jsx("span",{className:u(i?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:e.jsx(Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},s.id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"judul-notifikasi",className:"block text-sm font-bold text-gray-700 mb-1.5",children:"Judul Notifikasi"}),e.jsx("input",{type:"text",name:"judul-notifikasi",id:"judul-notifikasi",className:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3",placeholder:"e.g. Undangan Interview",value:c,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subjudul-notifikasi",className:"block text-sm font-bold text-gray-700 mb-1.5",children:"Subjudul / Kategori"}),e.jsx("input",{type:"text",name:"subjudul-notifikasi",id:"subjudul-notifikasi",className:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3",placeholder:"e.g. Tahap 2",value:x,onChange:s=>I(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"isi-pesan",className:"block text-sm font-bold text-gray-700 mb-1.5",children:"Isi Pesan"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{id:"isi-pesan",name:"isi-pesan",rows:6,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-xl p-3",placeholder:"Tulis pesan lengkap pemberitahuan di sini...",value:h,onChange:s=>k(s.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-right",children:"Mendukung format teks biasa."})]})]})]})}),e.jsx("div",{className:"flex items-center justify-end px-6 py-4 bg-gray-50 border-t border-gray-100 gap-3",children:g?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"px-5 py-2.5 text-sm font-bold text-gray-700 bg-white border border-gray-300 rounded-xl shadow-sm hover:bg-gray-50 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-gray-500",onClick:Q,disabled:y,children:"Kembali"}),e.jsx("button",{type:"button",className:"inline-flex items-center px-6 py-2.5 text-sm font-bold text-white bg-blue-600 border border-transparent rounded-xl shadow-lg hover:bg-blue-700 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",onClick:W,disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Kirim Sekarang"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"px-5 py-2.5 text-sm font-bold text-gray-700 bg-white border border-gray-300 rounded-xl shadow-sm hover:bg-gray-50 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-gray-500",onClick:f,children:"Batal"}),e.jsx("button",{type:"button",className:"inline-flex items-center px-6 py-2.5 text-sm font-bold text-white bg-blue-600 border border-transparent rounded-xl shadow-lg hover:bg-blue-700 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",onClick:q,children:"Lanjut"})]})})]})]}),R&&r&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity",onClick:v}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Detail Pesan"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informasi lengkap notifikasi terkirim"})]}),e.jsxs("button",{type:"button",className:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-full transition-colors",onClick:v,children:[e.jsx("span",{className:"sr-only",children:"Tutup"}),e.jsx(M,{className:"w-5 h-5"})]})]}),e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"bg-blue-50/50 p-4 rounded-xl border border-blue-100",children:[e.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase tracking-widest mb-1 block",children:"Penerima"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold mr-3",children:r.user_name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:r.user_name}),e.jsx("div",{className:"text-xs text-blue-600",children:r.user_email})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block",children:"Judul"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:r.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block",children:"Subjek / Kategori"}),e.jsx("p",{className:"text-gray-700 bg-gray-100 inline-block px-3 py-1 rounded-lg text-sm",children:r.subject})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block",children:"Isi Pesan"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200 text-sm text-gray-600 leading-relaxed whitespace-pre-wrap min-h-[120px]",children:r.message})]}),e.jsx("div",{className:"text-right pt-2",children:e.jsxs("span",{className:"text-xs text-gray-400 font-medium italic",children:["Dikirim pada: ",new Date(r.created_at).toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})})]})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex flex-col gap-3",children:e.jsx("button",{type:"button",className:"w-full px-5 py-2.5 text-sm font-bold text-gray-700 bg-white border border-gray-300 rounded-xl shadow-sm hover:bg-gray-50 transition-colors",onClick:v,children:"Tutup"})})]})]})]})};export{xe as default};
