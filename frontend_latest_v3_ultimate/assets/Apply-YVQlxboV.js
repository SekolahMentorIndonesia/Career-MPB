import{f as T,a as E,d as I,r,j as e,C as o,L as c,g as N,F}from"./index-B5frEt5u.js";import{U as K}from"./user-BRxEefNs.js";import{A as L}from"./arrow-right-BIe5Uh-o.js";const O=s=>{if(!s)return{percentage:0,isProfileComplete:!1,isDocumentUploaded:!1};const a=["name","phone","nik","religion","height","weight","birth_place","birth_date","ktp_address","ktp_rt","ktp_rw","ktp_kelurahan","ktp_kecamatan","ktp_kabupaten","domicile_address","domicile_rt","domicile_rw","domicile_kelurahan","domicile_kecamatan","domicile_kabupaten","last_education","major","gpa","skills"],n=a.filter(p=>{const l=s[p];return l!=null&&l!==""}),b=Math.round(n.length/a.length*100),u=n.length===a.length,g=!!s.photo;return{percentage:b,isProfileComplete:u,isDocumentUploaded:g}},Q=()=>{const{jobId:s}=T(),{user:a}=E(),{showNotification:n}=I(),[b,u]=r.useState(!1),[g,p]=r.useState(!0),[l,w]=r.useState(!1),[t,m]=r.useState(null),[P,C]=r.useState(""),[M,U]=r.useState(null),{percentage:z,isProfileComplete:i,isDocumentUploaded:x}=O(M||a),y=i;r.useEffect(()=>{a&&(async()=>{try{const d={Authorization:`Bearer ${localStorage.getItem("token")}`},v=await(await fetch(`${window.API_BASE_URL}/api/user/profile`,{headers:d})).json();v.success&&U(v.data);const A=await(await fetch(`${window.API_BASE_URL}/api/user/applications`,{headers:d})).json();if(A.success){const f=A.data.find(j=>j.job_id==s);if(f)if(f.status==="Ditolak"){const j=new Date(f.rejected_at),S=new Date-j,_=1440*60*1e3;if(S<_){m("rejected_cooldown");const D=_-S,B=Math.floor(D/(1e3*60*60)),R=Math.floor(D%(1e3*60*60)/(1e3*60));C(`Anda baru saja ditolak. Harap tunggu ${B} jam ${R} menit lagi sebelum melamar kembali.`)}else m("none")}else m("applied");else m("none")}}catch(h){console.error("Error fetching data:",h)}finally{p(!1)}})()},[a,s]);const $=async k=>{if(k.preventDefault(),!(!y||t!=="none")){w(!0);try{const d=await(await fetch(`${window.API_BASE_URL}/api/applications`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({job_id:s})})).json();d.success?(u(!0),n("success","Berhasil","Lamaran berhasil dikirim!")):n("error","Gagal",d.message||"Gagal mengirim lamaran")}catch{n("error","Kesalahan","Terjadi kesalahan koneksi")}finally{w(!1)}}};return g?e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):b?e.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center p-4 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(o,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Lamaran Terkirim!"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-md",children:"Terima kasih telah melamar. Tim HR kami akan mereview profil dan dokumen Anda. Pantau status lamaran di dashboard Anda."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{to:"/dashboard/user/overview",className:"px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all shadow-lg shadow-blue-200",children:"Ke Dashboard"}),e.jsx(c,{to:"/",className:"px-6 py-3 bg-white text-gray-700 font-bold rounded-xl border hover:bg-gray-50 transition-all",children:"Cari Lowongan Lain"})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Konfirmasi Lamaran"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Pastikan data Anda sudah benar sebelum mengirim lamaran."})]}),e.jsx(c,{to:"/",className:"text-sm font-bold text-blue-600 hover:underline",children:"Batal"})]}),y?e.jsxs("form",{onSubmit:$,className:"bg-white shadow-xl rounded-3xl p-8 border border-gray-100 overflow-hidden relative",children:[t==="applied"&&e.jsxs("div",{className:"mb-8 flex items-center gap-4 p-6 bg-green-50 rounded-2xl border border-green-100",children:[e.jsx("div",{className:"p-3 bg-green-600 rounded-xl text-white",children:e.jsx(o,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-green-900",children:"Sudah Melamar"}),e.jsx("p",{className:"text-sm text-green-700",children:"Anda sudah mengirimkan lamaran untuk posisi ini. Silakan cek status di dashboard."})]})]}),t==="rejected_cooldown"&&e.jsxs("div",{className:"mb-8 flex items-center gap-4 p-6 bg-red-50 rounded-2xl border border-red-100",children:[e.jsx("div",{className:"p-3 bg-red-600 rounded-xl text-white",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-900",children:"Belum Dapat Melamar Kembali"}),e.jsx("p",{className:"text-sm text-red-700",children:P})]})]}),t==="none"&&e.jsxs("div",{className:"mb-8 flex items-center gap-4 p-6 bg-blue-50 rounded-2xl border border-blue-100",children:[e.jsx("div",{className:"p-3 bg-blue-600 rounded-xl text-white",children:e.jsx(o,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900",children:"Profil & Dokumen Lengkap!"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Data Anda akan diteruskan ke tim rekrutmen kami."})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl bg-gray-50 border border-gray-100 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Nama Lengkap"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a?.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Telepon"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a?.phone})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-100 flex gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-yellow-700 leading-relaxed",children:"Dengan mengklik tombol di bawah, Anda menyatakan bahwa semua informasi yang diberikan adalah benar dan valid."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsx("button",{type:"submit",disabled:l||t!=="none",className:"w-full flex justify-center py-4 px-4 border border-transparent rounded-2xl shadow-lg shadow-blue-200 text-lg font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Memproses..."]}):t==="applied"?"Sudah Melamar":t==="rejected_cooldown"?"Coba Lagi Nanti":"Kirim Lamaran Sekarang"})})]}):e.jsxs("div",{className:"bg-white shadow-xl rounded-3xl overflow-hidden border border-orange-100",children:[e.jsxs("div",{className:"bg-orange-500 p-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-2xl",children:e.jsx(N,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Lengkapi Persyaratan"})]}),e.jsx("p",{className:"text-orange-50/90 leading-relaxed",children:"Maaf, Anda belum dapat melamar posisi ini. Silakan lengkapi data diri terlebih dahulu."})]}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-6 rounded-2xl border-2 transition-all ${i?"border-green-100 bg-green-50/50":"border-gray-100 bg-white"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${i?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:e.jsx(K,{className:"w-6 h-6"})}),i?e.jsx(o,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"text-xs font-bold text-orange-500 bg-orange-100 px-2 py-1 rounded-md",children:"Wajib"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:"Data Diri"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Biodata, Alamat, dan Pendidikan"}),!i&&e.jsxs(c,{to:"/dashboard/user/profile",className:"inline-flex items-center text-sm font-bold text-blue-600 hover:gap-2 transition-all",children:["Lengkapi Sekarang ",e.jsx(L,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:`p-6 rounded-2xl border-2 transition-all ${x?"border-green-100 bg-green-50/50":"border-gray-100 bg-white"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${x?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:e.jsx(F,{className:"w-6 h-6"})}),x?e.jsx(o,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"text-xs font-bold text-blue-500 bg-blue-100 px-2 py-1 rounded-md",children:"Opsional"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:"Dokumen Pendukung"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"CV, Pas Foto, dan KTP"}),!x&&e.jsxs(c,{to:"/dashboard/user/documents",className:"inline-flex items-center text-sm font-bold text-blue-600 hover:gap-2 transition-all",children:["Unggah Sekarang ",e.jsx(L,{className:"w-4 h-4"})]})]})]}),e.jsx("div",{className:"pt-6 border-t border-gray-100 text-center",children:e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Aplikasi Anda akan otomatis terbuka setelah semua persyaratan di atas terpenuhi."})})]})]})]})};export{Q as default};
